<!DOCTYPE html>
<html>
<head>
	<title>APP CLI</title>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
	<link rel="stylesheet" type="text/css" href="assets/css/bootstrap-better-nav.min.css">
    <link rel="stylesheet" type="text/css" href="assets/fontawesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/sweetalert-master/dist/sweetalert.css" type="text/css">
</head>
<body class="" style="background: #EEEEEF;">
    <div id="loading"><div id="msg"><i class="fa fa-circle-o-notch fa-spin"></i></div></div>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="mainNav">
        <div class="container">
            <a class="navbar-brand font-weight-bold" href="" style="padding-top: 0px;padding-bottom: 0px;">
                <img src="assets/images/logo-white-2.png" style="width: 145px;margin-left: -17px;margin-top: -20px;margin-bottom: -15px;height: 60px;">
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link px-md-3" href="viajes-por-realizar.html">Viajes por Realizar</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link px-md-3" href="viajes-realizados.html">Viajes Realizados</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link px-md-3" href="index.html">Salir</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


    <header class="">
        <div class="container">
            <div class="row">
                <div class="col-md">
                    <a href="viajes-por-realizar.html" class="btn btn-danger">volver</a>
                </div>
                <div class="col-md">
                    <legend class="text-center"><strong>Detalle de viaje </strong></legend>
                    <legend class="" style="font-size: 20px;">Nro Orden:  <span class="_orden"></span> - Viaje <span class="_viaje"></span></legend>
                </div>
            </div>
        </div>
    </header>

    <section id="">
        <div class="container">
            <div class="row">
                <div class="col-md">
                    <div class="card" style="margin-bottom: 20px;">
                        <div class="card-body">
                            <table class="table table-bordered">
                                <thead>
                                    <tr class="text-center">
                                        <th>Llegada al punto de partida</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="text-center">
                                        <td class="item-1"></td>
                                    </tr>    
                                </tbody>
                            </table>

                            <table class="table table-bordered">
                                <thead>
                                    <tr class="text-center">
                                        <th>Inicio de la carga</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="text-center">
                                        <td class="item-2"></td>
                                    </tr>    
                                </tbody>
                            </table>

                            <table class="table table-bordered">
                                <thead>
                                    <tr class="text-center">
                                        <th>Fin de la carga</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="text-center">
                                        <td class="item-3"></td>
                                    </tr>    
                                </tbody>
                            </table>

                            <table class="table table-bordered">
                                <thead>
                                    <tr class="text-center">
                                        <th>Salida punto carga</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="text-center">
                                        <td class="item-4"></td>
                                    </tr>    
                                </tbody>
                            </table>
                        </div>
                    </div>


                    <div class="card">
                        <div class="card-body">
                            <table class="table table-bordered">
                                <thead>
                                    <tr class="text-center">
                                        <th>Llegada al punto de entrega</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="text-center">
                                        <td class="item-5"></td>
                                    </tr>    
                                </tbody>
                            </table>

                            <table class="table table-bordered">
                                <thead>
                                    <tr class="text-center">
                                        <th>Inicio de la descarga</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="text-center">
                                        <td class="item-6"></td>
                                    </tr>    
                                </tbody>
                            </table>

                            <table class="table table-bordered">
                                <thead>
                                    <tr class="text-center">
                                        <th>Fin de la descarga</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="text-center">
                                        <td class="item-7"></td>
                                    </tr>    
                                </tbody>
                            </table>

                            <table class="table table-bordered">
                                <thead>
                                    <tr class="text-center">
                                        <th>Salida punto entrega</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="text-center">
                                        <td class="item-8"></td>
                                    </tr>    
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

	<script type="text/javascript" src="assets/js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="assets/js/bootstrap-better-nav.min.js"></script>
    <script type="text/javascript" src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/sweetalert-master/dist/sweetalert-dev.js"></script>
    <script src="assets/js/validate.js"></script>

    <script type="text/javascript">
        function loadDetalleViaje(){
            $("#loading").show();
            var _viaje = localStorage.getItem("viaje");
            _viaje = JSON.parse(_viaje);
            console.log(_viaje);
            $("._orden").html(_viaje.orden);
            $("._viaje").html(_viaje.viaje);
            
            var _url = 'http://localhost/transporte/tool/api/detalle-viaje.php?o='+_viaje.orden+'&v='+_viaje.viaje+'&c='+_viaje.chofer+'&e=03&token=b8507948000cf84378aee2a877fbfaff';
            $.ajax({
                method: "POST",
                url: _url,
                dataType: "json",
                encoding:"UTF-8",
                success: function(data){
                    var detalle = data.data;
                    console.log(detalle.pt_entrega);
                    if(detalle.pto_partida != ''){
                        $(".item-1").html(detalle.pto_partida);
                    }else{
                        $(".item-1").html('<a href="#" class="btn btn-success btn_marcar" data-tipo = "1" style="color: #fff;">asignar fecha y hora</a>');
                    }

                    if(detalle.ini_carga != ''){
                        $(".item-2").html(detalle.ini_carga);
                    }else{
                        $(".item-2").html('<a href="#" class="btn btn-success btn_marcar" data-tipo = "2" style="color: #fff;">asignar fecha y hora</a>');
                    }

                    if(detalle.fin_carga != ''){
                        $(".item-3").html(detalle.fin_carga);
                    }else{
                        $(".item-3").html('<a href="#" class="btn btn-success btn_marcar" data-tipo = "3" style="color: #fff;">asignar fecha y hora</a>');
                    }

                    if(detalle.sal_carga != ''){
                        $(".item-4").html(detalle.sal_carga);
                    }else{
                        $(".item-4").html('<a href="#" class="btn btn-success btn_marcar" data-tipo = "4" style="color: #fff;">asignar fecha y hora</a>');
                    }

                    if(detalle.pt_entrega != ''){
                        $(".item-5").html(detalle.pt_entrega);
                    }else{
                        $(".item-5").html('<a href="#" class="btn btn-success btn_marcar" data-tipo = "5" style="color: #fff;">asignar fecha y hora</a>');
                    }

                    if(detalle.ini_descarga != ''){
                        $(".item-6").html(detalle.ini_descarga);
                    }else{
                        $(".item-6").html('<a href="#" class="btn btn-success btn_marcar" data-tipo = "6" style="color: #fff;">asignar fecha y hora</a>');
                    }

                    if(detalle.fin_descarga != ''){
                        $(".item-7").html(detalle.fin_descarga);
                    }else{
                        $(".item-7").html('<a href="#" class="btn btn-success btn_marcar" data-tipo = "7" style="color: #fff;">asignar fecha y hora</a>');
                    }

                    if(detalle.sal_descarga != ''){
                        $(".item-8").html(detalle.sal_descarga);
                    }else{
                        $(".item-8").html('<a href="#" class="btn btn-success btn_marcar" data-tipo = "8" style="color: #fff;">asignar fecha y hora</a>');
                    }

                    $("#loading").hide();
                }
                
            });
        }

        loadDetalleViaje();


        $(document).on('click', '.btn_marcar', function (e) {
            e.preventDefault();
            var _tipo = $(this).attr("data-tipo");
            var _viaje = localStorage.getItem("viaje");
            _viaje = JSON.parse(_viaje);

            swal({
                title: "<h4>¿Esta seguro que desea registrar la fecha y hora?</h4>",
                text: "",
                type: "info",
                html: true,
                showCancelButton: true,
                closeOnConfirm: false,
                showLoaderOnConfirm: true
            }, function () {
                var _url = 'http://localhost/transporte/tool/api/actualizar-viaje-chofer.php?o='+_viaje.orden+'&v='+_viaje.viaje+'&c='+_viaje.chofer+'&t='+_tipo+'&e=03&token=b8507948000cf84378aee2a877fbfaff';
                $.ajax({
                    method: "POST",
                    url: _url,
                    dataType: "json",
                    encoding:"UTF-8",
                    success: function(data){
                        if(data.code == 200){
                            loadDetalleViaje();
                            swal.close();
                        }
                    }                    
                });

            });
        });



    </script>

</body>
</html>